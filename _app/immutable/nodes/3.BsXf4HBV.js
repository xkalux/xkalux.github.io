import{d as Ca,f as N,a as y,s as m,t as oa,c as $a}from"../chunks/BOX8SYRG.js";import{i as ka}from"../chunks/J4k10p99.js";import{o as La}from"../chunks/0g7lm0Hi.js";import{z as Oa,A as ra,B as Ba,C as ut,F as L,I as s,E as n,s as g,a as t,G as Ka,H as S,u as r,M as e,J as mt,N as vt,aE as Ta,aF as Pa}from"../chunks/Db4QX34E.js";import{i as O}from"../chunks/H1mLmQGd.js";import{i as H,l as Jt,e as Mt,a as It}from"../chunks/CHlFfwPK.js";import{a as at,r as Fa}from"../chunks/u531CL-n.js";import{b as Da}from"../chunks/Ddfq3vw5.js";import{b as Ra}from"../chunks/jGOv2rTN.js";import{b as Ea}from"../chunks/BSHUJz6l.js";import{a as gt,s as Ga}from"../chunks/DWhKGWJG.js";import{g as Ma}from"../chunks/CyAOr46U.js";import{w as St}from"../chunks/C2j6gFa2.js";import{a as Ht}from"../chunks/Dcnj4eNK.js";import{u as Ia}from"../chunks/Bpj4_Ifw.js";function Ua(...a){}function ja(a,i){return i.filter(o=>o.id===a)[0]}function Ja(a){return a?a.email.toLowerCase().includes("@rmuti.ac.th"):!1}function G(a,i){return a in i}function na(a){const i=[];for(const o in a)Object.hasOwn(a,o)&&(o.toLowerCase().includes("_hide")||i.push(o));return i}function Nt(a,i){if(i){for(const o of a)if(G(o,i))return o}}function ft(a){return Nt(["Points","POINTS","point","points","Point","POINT"],a)}function la(a){return Nt(["BonusAdded","BonusAdd","bonusadded","bonusadd","Bonus","bonus"],a)}function da(a){return Nt(["Grade","GRADE","grade","grad","Grad","GRAD"],a)}function ca(a){return Nt(["Total","total","TOTAL","Sum","sum"],a)}function ua(a){let i="F";if(!a)return i;const o=Number(a);return o>=80?i="A":o>=75?i="B+":o>=70?i="B":o>=65?i="C+":o>=60?i="C":o>=55?i="D+":o>=50&&(i="D"),i}function qt(a){return a===""||isNaN(Number(a))}function Sa(a,i,o){if(!a||!o||!o.rules_data[i])return;const A=o.rule.find(_=>_.name.toLowerCase()===i.toLowerCase());if(!A)return;let R=ft(o.summary),w=0,u={point:0,max_point:A.weight,denominator:A.numberOfActive};for(const _ in a){if(!Object.hasOwn(a,_)||!_.includes("_edit"))continue;let h=0;const f=a[_];if(!qt(f)){const P=Number(f);h+=P>1?1:P,a[_]=P>1?"1":f}u.point+=h}let M=ca(a);M&&(a[M]=`${u.point}/${u.denominator}`);let B=ft(a);B&&(a[B]=(u.point/u.denominator*u.max_point).toFixed(3),G(A.name,o.summary)&&(o.summary[A.name]=a[B]));for(const _ of o.rule){const h=o.rules_data[_.name];let f=ft(h);f&&(w+=Number(h[f]))}const p=la(o.summary);if(p){const h=o.summary[p].replaceAll("+","").trim();isNaN(Number(h))||(w+=Number(h),o.summary[p]=`+ ${h}`)}R&&(o.summary[R]=w);const I=da(o.summary);return I&&(o.summary[I]=ua(w)),o}function Ha(a){if(!a)return;let i=ft(a.summary),o=0;for(const w of a.rule){if(!G(w.name,a.summary))continue;let u=a.rules_data[w.name];if(!u)continue;let M={point:0,max_point:w.weight,denominator:w.numberOfActive};for(const I in u){if(!Object.hasOwn(u,I)||!I.includes("_edit"))continue;let _=0;const h=u[I];qt(h)?_=1:_=Number(h),M.point+=_,u[I]=_}let B=ca(u);B&&(u[B]=`${M.point}/${M.denominator}`);let p=ft(u);p&&(u[p]=(M.point/M.denominator*M.max_point).toFixed(3),G(w.name,a.summary)&&(a.summary[w.name]=u[p],o+=Number(u[p])))}const A=la(a.summary);if(A){const u=a.summary[A].replaceAll("+","").replaceAll("-","").trim();isNaN(Number(u))||(o+=Number(u))}i&&(a.summary[i]=o);const R=da(a.summary);return R&&(a.summary[R]=ua(o)),a}const Ut=St([]);async function ia(){H.set(!0),Jt.set("fetch classrooms");const a=at.classrooms.load();if(a){Ut.set(a),H.set(!1);return}const i=await Ht.getClassRooms();i.error||(Ut.set(i.data),at.classrooms.save(i.data)),H.set(!1)}const jt=St(void 0);async function qa(a){H.set(!0),Jt.set("fetch passport");const i=at.passport.load();if(i){jt.set(i),H.set(!1);return}const o=await Ht.getPassword(a);o.error||(jt.set(o.data),at.passport.save(o.data)),H.set(!1)}const ht=St(void 0);async function za(a,i,o){H.set(!0),Jt.set(`fetch ${a.id} score`);const A=at.classSheetScore.load();if(A){const w=A.find(u=>u.id===a.id);if(w!==void 0){ht.set(w.sheetScore),H.set(!1);return}}Ua(`   -> ✅ not found scores of ${a.id} from local storage !`);const R=await Ht.getSheetScore(i,a.sheet_url,o);R.error||(ht.set(R.data),at.classSheetScore.push({id:a.id,sheetScore:R.data})),H.set(!1)}var Wa=N('<input type="number" placeholder="คะแนน ระหว่าง 0 ~ 1" class="input"/>'),Xa=N("<!> <!>",1),Ya=N("<tr><td> </td><td><!> <!></td></tr>"),Qa=N("<option> </option>"),Va=N('<td class="text-center"><div class="tooltip"><div class="tooltip-content"><div class="animate-bounce text-secondary -rotate-10 text-xl font-black">Click!</div></div> <button class="cursor-pointer link-secondary underline underline-offset-5 text-right whitespace-nowrap w-20 text-base hover:bg-base-200"> </button></div> </td>'),Za=N('<td class="text-center"><div class="tooltip"><div class="tooltip-content"><div class="animate-bounce text-success -rotate-10 text-lg font-black">Click!</div></div> <button class="cursor-pointer link-success underline underline-offset-5 text-right whitespace-nowrap w-20 text-base hover:bg-base-200"> </button></div> </td>'),te=N('<tr><td class="w-40 text-base"> </td><td class="text-center"><div class="tooltip"><div class="tooltip-content"><div class="animate-bounce text-info -rotate-10 text-xl font-black">Click!</div></div> <button class="cursor-pointer link-info underline underline-offset-5 text-right whitespace-nowrap w-20 text-base hover:bg-base-200"> </button></div> </td><!><!></tr>'),ae=N('<div class="tooltip"><div class="tooltip-content"><div class="animate-bounce text-info -rotate-10 text-lg font-black">Click!</div></div> <button class="cursor-pointer link-info underline underline-offset-5 text-right whitespace-nowrap w-20 text-base"> </button></div>'),ee=N('<button class=" text-right whitespace-nowrap w-20 text-base"> </button>'),se=N('<td class="text-center"><button class=" text-right whitespace-nowrap w-20 text-base"> </button></td> <td class="text-center"><button class=" text-right whitespace-nowrap w-20 text-base"> </button></td>',1),oe=N('<tr><td class="text-base">BonusAdded:</td><td class="text-center"><!> <!></td><!></tr>'),re=N('<td class="text-center"><button class=" text-right whitespace-nowrap w-20 text-base font-semibold"> </button> / 100 <span class="text-base">(<span class="font-semibold"> </span>)</span></td>'),ne=N('<td class="text-center"><button class=" text-right whitespace-nowrap w-20 text-base font-semibold"> </button> / 100 <span class="text-base">(<span class="font-semibold"> </span>)</span></td>'),ie=N('<div class="ml-5 mr-5"><h1 class="mt-2">Name: <span class="thai-lang text-lg font-semibold"> </span>, STUDENT_NO: <span class="font-semibold"> </span>, Row: <span class="font-semibold"> </span></h1></div> <table class="table table-md ml-4 mt-2"><thead><tr><th class="w-40">TYPE</th><th class="text-center"><div class="tooltip"><div class="tooltip-content"><div class="font-black">คะแนนปัจจุบัน</div></div> ACTUAL</div></th><th class="text-center"><div class="tooltip"><div class="tooltip-content"><div class="font-black">คะแนนสูงสุดที่เป็นไปได้</div></div> BEST</div></th><th class="text-center"><div class="tooltip"><div class="tooltip-content"><div class="font-black">ทดลองคำนวณคะแนนที่คาดว่าจะได้</div></div> SANDBOX</div></th></tr></thead><tbody><!><!><tr><td class="text-base">Total:</td><td class="text-center"><button class=" text-right whitespace-nowrap w-20 text-base font-semibold"> </button> / 100 <span class="text-base">(<span class="font-semibold"> </span>)</span></td><!><!></tr></tbody></table>',1),le=N('<div class="hero bg-base-100 rounded-2xl h-full"><div class="hero-content text-center h-full"><div class="max-w-5xl h-full"><h1 class="text-xl font-bold mt-10">Who are you again? Our system has no memory of you.</h1> <div class="text-left mt-5"><p class="py-6 text-lg">ตรวจสอบข้อมูลการลงทะเบียนใน discord โดยใช้คำสั่ง <span class="font-semibold">/info</span><br/><br/> - หากพบว่าไม่ถูกต้องให้ยื่นเรื่องแก้ไขข้อมูลผ่านคำสั่ง <span class="font-semibold">/request-change</span></p></div></div></div></div>'),de=N('<dialog id="sheet_modal" class="modal"><div class="modal-box"><h3 class="text-lg font-bold"> </h3> <table class="table table-sm"><tbody></tbody></table> <form method="dialog"><button class="btn btn-sm btn-circle btn-ghost absolute right-2 top-2">✕</button></form></div> <form method="dialog" class="modal-backdrop"><button>x</button></form></dialog> <div class="flex w-full flex-col"><div class=" w-full bg-base-300 rounded-2xl pt-2 pb-2"><div class="flex items-center justify-between gap-3 px-3"><p class="text-base font-medium ml-2"> </p> <div class="shrink-0 mr-2"><select class="select select-bordered w-70"><option selected disabled>Pick a classroom</option><!></select></div></div></div> <div class="divider mt-1 mb-1"></div> <!> <!></div> <div class="fab"><div tabindex="0" role="button" class="btn btn-lg btn-circle mb-15"><span class="icon material-symbols-outlined" aria-hidden="true">settings</span></div> <button class="btn btn-s text-xs"><span class="icon material-symbols-outlined" aria-hidden="true">delete_forever</span>Clear Cache</button></div>',1);function Ce(a,i){Oa(i,!1);const o=()=>gt(Ia,"$user",u),A=()=>gt(Ut,"$classrooms",u),R=()=>gt(jt,"$passport",u),w=()=>gt(ht,"$sheetScores",u),[u,M]=Ga();(!o()||!Ja(o()))&&Ma("/unauthorised");let B=S(),p=S(""),I=S(0),_,h=S(null),f=S(null),P=S(""),q=S(""),d=S(),C=S(),x=S();const it=new Map;async function ma(v){if(_=ja(t(p),A()),_&&R()){if(g(B,_.members.find(c=>c.email===o()?.email)),!t(B))return;g(I,t(B).row),await za(_,R(),t(I)),g(d,w()),g(C,JSON.parse(JSON.stringify(t(d)))),g(C,Ha(t(C))),g(x,JSON.parse(JSON.stringify(t(d))));for(const c of t(x)?.rule??[]){const b=t(x)?.rules_data[c.name];if(b!==void 0)for(const F in b)Object.hasOwn(b,F)&&F.includes("_edit")&&qt(b[F])&&(it.has(c.name)||it.set(c.name,new Set),it.get(c.name)?.add(F))}}}function pt(v,c="actual"){if(g(P,v),v.toLowerCase()==="bonus")g(f,w()?.bonus);else switch(g(q,c),c){case"best":g(f,t(C)?.rules_data[v]);break;case"sandbox":g(f,t(x)?.rules_data[v]);break;default:g(f,t(d)?.rules_data[v]);break}t(h)?.showModal()}La(async()=>{ht.set(void 0),o()&&await qa(o()),await ia()}),ra(()=>t(p),()=>{t(p)&&ma(t(p))}),ra(()=>(t(x),t(q),t(f),t(P)),()=>{t(x)&&t(q).toLowerCase()==="sandbox"&&g(x,Sa(t(f),t(P),t(x)))}),Ba(),ka();var zt=de(),bt=ut(zt),Wt=s(bt),At=s(Wt),va=s(At);e(At);var Xt=n(At,2),Yt=s(Xt);Mt(Yt,5,()=>(mt(na),t(f),r(()=>na(t(f)))),It,(v,c)=>{var b=Ya(),F=s(b),V=s(F,!0);e(F);var rt=n(F),z=s(rt);{var Bt=E=>{var Z=Xa(),lt=ut(Z);{var xt=U=>{var J=Wa();Fa(J),Da(J,()=>t(f)[t(c)],Pt=>Pa(f,t(f)[t(c)]=Pt)),y(U,J)};O(lt,U=>{t(P),t(c),r(()=>it.get(t(P))?.has(t(c)))&&U(xt)})}var Tt=n(lt,2);{var yt=U=>{var J=oa();L(()=>m(J,(t(f),t(c),r(()=>t(f)[t(c)])))),y(U,J)};O(Tt,U=>{t(P),t(c),r(()=>!it.get(t(P))?.has(t(c)))&&U(yt)})}y(E,Z)};O(z,E=>{t(q),r(()=>t(q).toLowerCase()==="sandbox")&&E(Bt)})}var _t=n(z,2);{var Kt=E=>{var Z=oa();L(()=>m(Z,(t(f),t(c),r(()=>t(f)[t(c)])))),y(E,Z)};O(_t,E=>{t(q),r(()=>t(q).toLowerCase()!=="sandbox")&&E(Kt)})}e(rt),e(b),L(E=>m(V,E),[()=>(t(c),r(()=>t(c).replaceAll("_edit","").replaceAll("_not","")))]),y(v,b)}),e(Yt),e(Xt),vt(2),e(Wt),vt(2),e(bt),Ea(bt,v=>g(h,v),()=>t(h));var Ct=n(bt,2),$t=s(Ct),Qt=s($t),kt=s(Qt),fa=s(kt,!0);e(kt);var Vt=n(kt,2),Lt=s(Vt);L(()=>{t(p),Ta(()=>{A()})});var Ot=s(Lt);Ot.value=Ot.__value="";var pa=n(Ot);Mt(pa,1,A,It,(v,c)=>{var b=Qa(),F=s(b,!0);e(b);var V={};L((rt,z)=>{m(F,rt),V!==(V=z)&&(b.value=(b.__value=z)??"")},[()=>(t(c),r(()=>t(c).name.replaceAll("_"," ").toUpperCase())),()=>(t(c),r(()=>String(t(c).id)))]),y(v,b)}),e(Lt),e(Vt),e(Qt),e($t);var Zt=n($t,4);{var ba=v=>{var c=ie(),b=ut(c),F=s(b),V=n(s(F)),rt=s(V,!0);e(V);var z=n(V,2),Bt=s(z,!0);e(z);var _t=n(z,2),Kt=s(_t,!0);e(_t),e(F),e(b);var E=n(b,2),Z=n(s(E)),lt=s(Z);Mt(lt,1,()=>(t(d),r(()=>t(d).rule)),It,($,l)=>{var K=$a(),tt=ut(K);{var W=j=>{var X=te(),Y=s(X),Ft=s(Y);e(Y);var k=n(Y),T=s(k),D=n(s(T),2);D.__click=()=>pt(t(l).name);var nt=s(D,!0);e(D),e(T);var dt=n(T);e(k);var ct=n(k);{var wt=Q=>{var et=Va(),st=s(et),ot=n(s(st),2);ot.__click=()=>pt(t(l).name,"best");var Rt=s(ot,!0);e(ot),e(st);var Et=n(st);e(et),L(Gt=>{m(Rt,Gt),m(Et,` / ${t(l),r(()=>t(l).weight)??""}`)},[()=>(t(C),t(l),r(()=>Number(t(C).summary[t(l).name]).toFixed(3)))]),y(Q,et)};O(ct,Q=>{t(C),t(l),mt(G),r(()=>t(C)?.summary&&t(l).weight>0&&G(t(l).name,t(C).summary))&&Q(wt)})}var Dt=n(ct);{var Aa=Q=>{var et=Za(),st=s(et),ot=n(s(st),2);ot.__click=()=>pt(t(l).name,"sandbox");var Rt=s(ot,!0);e(ot),e(st);var Et=n(st);e(et),L(Gt=>{m(Rt,Gt),m(Et,` / ${t(l),r(()=>t(l).weight)??""}`)},[()=>(t(x),t(l),r(()=>Number(t(x).summary[t(l).name]).toFixed(3)))]),y(Q,et)};O(Dt,Q=>{t(x),t(l),mt(G),r(()=>t(x)?.summary&&t(l).weight>0&&G(t(l).name,t(x).summary))&&Q(Aa)})}e(X),L(Q=>{m(Ft,`${t(l),r(()=>t(l).name)??""}:`),m(nt,Q),m(dt,` / ${t(l),r(()=>t(l).weight)??""}`)},[()=>(t(d),t(l),r(()=>Number(t(d).summary[t(l).name]).toFixed(3)))]),y(j,X)};O(tt,j=>{t(l),mt(G),t(d),r(()=>t(l).weight>0&&G(t(l).name,t(d).summary))&&j(W)})}y($,K)});var xt=n(lt);{var Tt=$=>{var l=oe(),K=n(s(l)),tt=s(K);{var W=k=>{var T=ae(),D=n(s(T),2);D.__click=()=>pt("bonus");var nt=s(D);e(D),e(T),L(dt=>m(nt,`+ ${dt??""}`),[()=>(t(d),r(()=>Number(t(d).summary.BonusAdded.replaceAll("+","")).toFixed(3)))]),y(k,T)};O(tt,k=>{t(d),r(()=>!isNaN(Number(t(d).summary.BonusAdded.replaceAll("+",""))))&&k(W)})}var j=n(tt,2);{var X=k=>{var T=ee(),D=s(T,!0);e(T),L(()=>m(D,(t(d),r(()=>t(d).summary.BonusAdded)))),y(k,T)};O(j,k=>{t(d),r(()=>isNaN(Number(t(d).summary.BonusAdded.replaceAll("+",""))))&&k(X)})}e(K);var Y=n(K);{var Ft=k=>{var T=se(),D=ut(T),nt=s(D),dt=s(nt,!0);e(nt),e(D);var ct=n(D,2),wt=s(ct),Dt=s(wt,!0);e(wt),e(ct),L(()=>{m(dt,(t(d),r(()=>t(d)?.summary.BonusAdded))),m(Dt,(t(d),r(()=>t(d)?.summary.BonusAdded)))}),y(k,T)};O(Y,k=>{t(d),r(()=>t(d)?.summary.BonusAdded)&&k(Ft)})}e(l),y($,l)};O(xt,$=>{mt(G),t(d),r(()=>G("BonusAdded",t(d).summary))&&$(Tt)})}var yt=n(xt),U=n(s(yt)),J=s(U),Pt=s(J,!0);e(J);var aa=n(J,2),ea=n(s(aa)),wa=s(ea,!0);e(ea),vt(),e(aa),e(U);var sa=n(U);{var ga=$=>{var l=re(),K=s(l),tt=s(K,!0);e(K);var W=n(K,2),j=n(s(W)),X=s(j,!0);e(j),vt(),e(W),e(l),L(Y=>{m(tt,Y),m(X,(t(C),r(()=>t(C).summary.Grade)))},[()=>(t(C),r(()=>Number(t(C).summary.Points).toFixed(3)))]),y($,l)};O(sa,$=>{t(C),r(()=>t(C)?.summary)&&$(ga)})}var ha=n(sa);{var Na=$=>{var l=ne(),K=s(l),tt=s(K,!0);e(K);var W=n(K,2),j=n(s(W)),X=s(j,!0);e(j),vt(),e(W),e(l),L(Y=>{m(tt,Y),m(X,(t(x),r(()=>t(x).summary.Grade)))},[()=>(t(x),r(()=>Number(t(x).summary.Points).toFixed(3)))]),y($,l)};O(ha,$=>{t(x),r(()=>t(x)?.summary)&&$(Na)})}e(yt),e(Z),e(E),L($=>{m(rt,(t(d),r(()=>t(d).summary.FULLNAME))),m(Bt,(t(d),r(()=>t(d).summary.STUDENT_NO))),m(Kt,t(I)),m(Pt,$),m(wa,(t(d),r(()=>t(d).summary.Grade)))},[()=>(t(d),r(()=>Number(t(d).summary.Points).toFixed(3)))]),y(v,c)};O(Zt,v=>{t(d),t(B),r(()=>t(d)?.summary&&t(B))&&v(ba)})}var _a=n(Zt,2);{var xa=v=>{var c=le();y(v,c)};O(_a,v=>{!t(B)&&t(p)!==""&&v(xa)})}e(Ct);var ta=n(Ct,2),ya=n(s(ta),2);ya.__click=async()=>{at.classSheetScore.destroy(),at.classrooms.destroy(),H.set(!0),await ia(),g(p,""),g(B,void 0)},e(ta),L((v,c,b)=>{m(va,`${v??""}
      ${c??""}`),m(fa,b)},[()=>(t(q),r(()=>t(q).toLocaleUpperCase())),()=>(t(P),r(()=>t(P).toUpperCase())),()=>(t(p),r(()=>t(p).toUpperCase()))]),Ra(Lt,()=>t(p),v=>g(p,v)),y(a,zt),Ka(),M()}Ca(["click"]);export{Ce as component};
