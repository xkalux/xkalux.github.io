import{d as $a,f as B,a as g,s as f,t as oa,c as La}from"../chunks/CsIN25Ky.js";import{i as Ba}from"../chunks/PcqcHE3R.js";import{a as Ca}from"../chunks/BINHKKf2.js";import{n as Oa,x as lt,aB as Ka,M as ka,u as n,r as Ta,y as Pa,z as Da,A as na,B as Ea,C as dt,G as k,F as r,E as l,a as t,H as Fa,I as q,s as D,J as s,as as ut,K as ct,aD as Ra,aE as Ma}from"../chunks/BIYywunZ.js";import{i as T}from"../chunks/CRXV3zYL.js";import{i as j,l as Jt,e as Mt,a as Gt}from"../chunks/1oHT7Rzc.js";import{s as at,r as Ga}from"../chunks/Cx1DLMHF.js";import{b as Sa}from"../chunks/CRACzlvV.js";import{b as Ia}from"../chunks/cuhRkdYf.js";import{a as wt,s as Ua}from"../chunks/CVuxcOWQ.js";import{g as ja}from"../chunks/DrdekEuy.js";import{w as Ht}from"../chunks/Cu0YfLRo.js";import{a as Vt}from"../chunks/BX0cc14o.js";import{u as Ja}from"../chunks/DaEkzCcS.js";function Ha(a,o,e=o){var p=new WeakSet;Oa(a,"input",async x=>{var m=x?a.defaultValue:a.value;if(m=St(a)?It(m):m,e(m),lt!==null&&p.add(lt),await Ka(),m!==(m=o())){var c=a.selectionStart,A=a.selectionEnd,y=a.value.length;if(a.value=m??"",A!==null){var N=a.value.length;c===A&&A===y&&N>y?(a.selectionStart=N,a.selectionEnd=N):(a.selectionStart=c,a.selectionEnd=Math.min(A,N))}}}),(ka&&a.defaultValue!==a.value||n(o)==null&&a.value)&&(e(St(a)?It(a.value):a.value),lt!==null&&p.add(lt)),Ta(()=>{var x=o();if(a===document.activeElement){var m=Pa??lt;if(p.has(m))return}St(a)&&x===It(a.value)||a.type==="date"&&!x&&!a.value||x!==a.value&&(a.value=x??"")})}function St(a){var o=a.type;return o==="number"||o==="range"}function It(a){return a===""?null:+a}function Va(...a){}function za(a,o){return o.filter(e=>e.id===a)[0]}function Wa(a){return a?a.email.toLowerCase().includes("@rmuti.ac.th"):!1}function G(a,o){return a in o}function ia(a){const o=[];for(const e in a)Object.hasOwn(a,e)&&(e.toLowerCase().includes("_hide")||o.push(e));return o}function ht(a,o){if(o){for(const e of a)if(G(e,o))return e}}function mt(a){return ht(["Points","POINTS","point","points","Point","POINT"],a)}function da(a){return ht(["BonusAdded","BonusAdd","bonusadded","bonusadd","Bonus","bonus"],a)}function ua(a){return ht(["Grade","GRADE","grade","grad","Grad","GRAD"],a)}function ca(a){return ht(["Total","total","TOTAL","Sum","sum"],a)}function ma(a){let o="F";if(!a)return o;const e=Number(a);return e>=80?o="A":e>=75?o="B+":e>=70?o="B":e>=65?o="C+":e>=60?o="C":e>=55?o="D+":e>=50&&(o="D"),o}function zt(a){return a===""||isNaN(Number(a))}function Xa(a,o,e){if(!a||!e||!e.rules_data[o])return;const p=e.rule.find(h=>h.name.toLowerCase()===o.toLowerCase());if(!p)return;let x=mt(e.summary),m=0,c={point:0,max_point:p.weight,denominator:p.numberOfActive};for(const h in a){if(!Object.hasOwn(a,h)||!h.includes("_edit"))continue;let v=0;const $=a[h];if(!zt($)){const E=Number($);v+=E>1?1:E,a[h]=E>1?"1":$}c.point+=v}let A=ca(a);A&&(a[A]=`${c.point}/${c.denominator}`);let y=mt(a);y&&(a[y]=(c.point/c.denominator*c.max_point).toFixed(3),G(p.name,e.summary)&&(e.summary[p.name]=a[y]));for(const h of e.rule){const v=e.rules_data[h.name];let $=mt(v);$&&(m+=Number(v[$]))}const N=da(e.summary);if(N){const v=e.summary[N].replaceAll("+","").trim();isNaN(Number(v))||(m+=Number(v),e.summary[N]=`+ ${v}`)}x&&(e.summary[x]=m);const R=ua(e.summary);return R&&(e.summary[R]=ma(m)),e}function Ya(a){if(!a)return;let o=mt(a.summary),e=0;for(const m of a.rule){if(!G(m.name,a.summary))continue;let c=a.rules_data[m.name];if(!c)continue;let A={point:0,max_point:m.weight,denominator:m.numberOfActive};for(const R in c){if(!Object.hasOwn(c,R)||!R.includes("_edit"))continue;let h=0;const v=c[R];zt(v)?h=1:h=Number(v),A.point+=h,c[R]=h}let y=ca(c);y&&(c[y]=`${A.point}/${A.denominator}`);let N=mt(c);N&&(c[N]=(A.point/A.denominator*A.max_point).toFixed(3),G(m.name,a.summary)&&(a.summary[m.name]=c[N],e+=Number(c[N])))}const p=da(a.summary);if(p){const c=a.summary[p].replaceAll("+","").replaceAll("-","").trim();isNaN(Number(c))||(e+=Number(c))}o&&(a.summary[o]=e);const x=ua(a.summary);return x&&(a.summary[x]=ma(e)),a}const Ut=Ht([]);async function la(){j.set(!0),Jt.set("fetch classrooms");const a=at.classrooms.load();if(a){Ut.set(a),j.set(!1);return}const o=await Vt.getClassRooms();o.error||(Ut.set(o.data),at.classrooms.save(o.data)),j.set(!1)}const jt=Ht(void 0);async function qa(a){j.set(!0),Jt.set("fetch passport");const o=at.passport.load();if(o){jt.set(o),j.set(!1);return}const e=await Vt.getPassword(a);e.error||(jt.set(e.data),at.passport.save(e.data)),j.set(!1)}const gt=Ht(void 0);async function Qa(a,o,e){j.set(!0),Jt.set(`fetch ${a.id} score`);const p=at.classSheetScore.load();if(p){const m=p.find(c=>c.id===a.id);if(m!==void 0){gt.set(m.sheetScore),j.set(!1);return}}Va(`   -> ✅ not found scores of ${a.id} from local storage !`);const x=await Vt.getSheetScore(o,a.sheet_url,e);x.error||(gt.set(x.data),at.classSheetScore.push({id:a.id,sheetScore:x.data})),j.set(!1)}var Za=B('<input type="number" placeholder="คะแนน ระหว่าง 0 ~ 1" class="input"/>'),te=B("<!> <!>",1),ae=B("<tr><td> </td><td><!> <!></td></tr>"),ee=B("<option> </option>"),se=B('<td class="text-center"><button class="cursor-pointer link-info underline underline-offset-5 text-right whitespace-nowrap w-20 text-base hover:bg-base-200"> </button> </td>'),re=B('<td class="text-center"><button class="cursor-pointer link-success underline underline-offset-5 text-right whitespace-nowrap w-20 text-base hover:bg-base-200"> </button> </td>'),oe=B('<tr><td class="w-40 text-base"> </td><td class="text-center"><button class="cursor-pointer link-primary underline underline-offset-5 text-right whitespace-nowrap w-20 text-base hover:bg-base-200"> </button> </td><!><!></tr>'),ne=B('<button class="cursor-pointer link-primary underline underline-offset-5 text-right whitespace-nowrap w-20 text-base"> </button>'),ie=B('<button class=" text-right whitespace-nowrap w-20 text-base"> </button>'),le=B('<td class="text-center"><button class=" text-right whitespace-nowrap w-20 text-base"> </button></td> <td class="text-center"><button class=" text-right whitespace-nowrap w-20 text-base"> </button></td>',1),de=B('<tr><td class="text-base">BonusAdded:</td><td class="text-center"><!> <!></td><!></tr>'),ue=B('<td class="text-center"><button class=" text-right whitespace-nowrap w-20 text-base font-semibold"> </button> / 100 <span class="text-base">(<span class="font-semibold"> </span>)</span></td>'),ce=B('<td class="text-center"><button class=" text-right whitespace-nowrap w-20 text-base font-semibold"> </button> / 100 <span class="text-base">(<span class="font-semibold"> </span>)</span></td>'),me=B('<div class="ml-5 mr-5"><h1 class="mt-2">Name: <span class="thai-lang text-lg font-semibold"> </span>, STUDENT_NO: <span class="font-semibold"> </span>, Row: <span class="font-semibold"> </span></h1></div> <table class="table table-md ml-4 mt-2"><thead><tr><th class="w-40">TYPE</th><th class="text-center">ACTUAL</th><th class="text-center">BEST</th><th class="text-center">SANDBOX</th></tr></thead><tbody><!><!><tr><td class="text-base">Total:</td><td class="text-center"><button class=" text-right whitespace-nowrap w-20 text-base font-semibold"> </button> / 100 <span class="text-base">(<span class="font-semibold"> </span>)</span></td><!><!></tr></tbody></table>',1),ve=B('<button class="btn btn-s text-xs"><span class="icon material-symbols-outlined" aria-hidden="true">playground_2</span>Sand Box</button>'),fe=B('<dialog id="sheet_modal" class="modal"><div class="modal-box"><h3 class="text-lg font-bold"> </h3> <table class="table table-sm"><tbody></tbody></table> <form method="dialog"><button class="btn btn-sm btn-circle btn-ghost absolute right-2 top-2">✕</button></form></div> <form method="dialog" class="modal-backdrop"><button>x</button></form></dialog> <div class="flex w-full flex-col"><div class=" w-full bg-base-300 rounded-2xl pt-2 pb-2"><div class="flex items-center justify-between gap-3 px-3"><p class="text-base font-medium ml-2"> </p> <div class="shrink-0 mr-2"><select class="select select-bordered w-70"><option selected disabled>Pick a classroom</option><!></select></div></div></div> <div class="divider mt-1 mb-1"></div> <!></div> <div class="fab"><div tabindex="0" role="button" class="btn btn-lg btn-circle mb-15"><span class="icon material-symbols-outlined" aria-hidden="true">settings</span></div> <button class="btn btn-s text-xs"><span class="icon material-symbols-outlined" aria-hidden="true">delete_forever</span>Clear Cache</button> <!></div>',1);function Oe(a,o){Da(o,!1);const e=()=>wt(Ja,"$user",c),p=()=>wt(Ut,"$classrooms",c),x=()=>wt(jt,"$passport",c),m=()=>wt(gt,"$sheetScores",c),[c,A]=Ua();(!e()||!Wa(e()))&&ja("/unauthorised");let y=q(""),N=q(0),R,h=q(null),v=q(null),$=q(""),E=q(""),d=q(),C=q(),w=q();const ot=new Map;async function va(_){if(R=za(t(y),p()),R&&x()){D(N,R.members.filter(u=>u.email===e()?.email)[0].row),await Qa(R,x(),t(N)),D(d,m()),D(C,JSON.parse(JSON.stringify(t(d)))),D(C,Ya(t(C))),D(w,JSON.parse(JSON.stringify(t(d))));for(const u of t(w)?.rule??[]){const b=t(w)?.rules_data[u.name];if(b!==void 0)for(const F in b)Object.hasOwn(b,F)&&F.includes("_edit")&&zt(b[F])&&(ot.has(u.name)||ot.set(u.name,new Set),ot.get(u.name)?.add(F))}}}function nt(_,u="actual"){if(D($,_),_.toLowerCase()==="bonus")D(v,m()?.bonus);else switch(D(E,u),u){case"best":D(v,t(C)?.rules_data[_]);break;case"sandbox":D(v,t(w)?.rules_data[_]);break;default:D(v,t(d)?.rules_data[_]);break}t(h)?.showModal()}Ca(async()=>{gt.set(void 0),e()&&await qa(e()),await la()}),na(()=>t(y),()=>{t(y)&&va(t(y))}),na(()=>(t(w),t(E),t(v),t($)),()=>{t(w)&&t(E).toLowerCase()==="sandbox"&&D(w,Xa(t(v),t($),t(w)))}),Ea(),Ba();var Wt=fe(),vt=dt(Wt),Xt=r(vt),Nt=r(Xt),fa=r(Nt);s(Nt);var Yt=l(Nt,2),qt=r(Yt);Mt(qt,5,()=>(ut(ia),t(v),n(()=>ia(t(v)))),Gt,(_,u)=>{var b=ae(),F=r(b),Q=r(F,!0);s(F);var st=l(F),J=r(st);{var Ot=M=>{var Z=te(),it=dt(Z);{var _t=S=>{var U=Za();Ga(U),Ha(U,()=>t(v)[t(u)],Tt=>Ma(v,t(v)[t(u)]=Tt)),g(S,U)};T(it,S=>{t($),t(u),n(()=>ot.get(t($))?.has(t(u)))&&S(_t)})}var kt=l(it,2);{var bt=S=>{var U=oa();k(()=>f(U,(t(v),t(u),n(()=>t(v)[t(u)])))),g(S,U)};T(kt,S=>{t($),t(u),n(()=>!ot.get(t($))?.has(t(u)))&&S(bt)})}g(M,Z)};T(J,M=>{t(E),n(()=>t(E).toLowerCase()==="sandbox")&&M(Ot)})}var ft=l(J,2);{var Kt=M=>{var Z=oa();k(()=>f(Z,(t(v),t(u),n(()=>t(v)[t(u)])))),g(M,Z)};T(ft,M=>{t(E),n(()=>t(E).toLowerCase()!=="sandbox")&&M(Kt)})}s(st),s(b),k(M=>f(Q,M),[()=>(t(u),n(()=>t(u).replaceAll("_edit","").replaceAll("_not","")))]),g(_,b)}),s(qt),s(Yt),ct(2),s(Xt),ct(2),s(vt),Ia(vt,_=>D(h,_),()=>t(h));var At=l(vt,2),$t=r(At),Qt=r($t),Lt=r(Qt),_a=r(Lt,!0);s(Lt);var Zt=l(Lt,2),Bt=r(Zt);k(()=>{t(y),Ra(()=>{p()})});var Ct=r(Bt);Ct.value=Ct.__value="";var ba=l(Ct);Mt(ba,1,p,Gt,(_,u)=>{var b=ee(),F=r(b,!0);s(b);var Q={};k((st,J)=>{f(F,st),Q!==(Q=J)&&(b.value=(b.__value=J)??"")},[()=>(t(u),n(()=>t(u).name.replaceAll("_"," ").toUpperCase())),()=>(t(u),n(()=>String(t(u).id)))]),g(_,b)}),s(Bt),s(Zt),s(Qt),s($t);var pa=l($t,4);{var xa=_=>{var u=me(),b=dt(u),F=r(b),Q=l(r(F)),st=r(Q,!0);s(Q);var J=l(Q,2),Ot=r(J,!0);s(J);var ft=l(J,2),Kt=r(ft,!0);s(ft),s(F),s(b);var M=l(b,2),Z=l(r(M)),it=r(Z);Mt(it,1,()=>(t(d),n(()=>t(d).rule)),Gt,(O,i)=>{var P=La(),tt=dt(P);{var H=I=>{var V=oe(),z=r(V),Pt=r(z);s(z);var K=l(z),L=r(K);L.__click=()=>nt(t(i).name);var W=r(L,!0);s(L);var rt=l(L);s(K);var pt=l(K);{var xt=X=>{var et=se(),Y=r(et);Y.__click=()=>nt(t(i).name,"best");var Et=r(Y,!0);s(Y);var Ft=l(Y);s(et),k(Rt=>{f(Et,Rt),f(Ft,` / ${t(i),n(()=>t(i).weight)??""}`)},[()=>(t(C),t(i),n(()=>Number(t(C).summary[t(i).name]).toFixed(3)))]),g(X,et)};T(pt,X=>{t(C),t(i),ut(G),n(()=>t(C)?.summary&&t(i).weight>0&&G(t(i).name,t(C).summary))&&X(xt)})}var yt=l(pt);{var Dt=X=>{var et=re(),Y=r(et);Y.__click=()=>nt(t(i).name,"sandbox");var Et=r(Y,!0);s(Y);var Ft=l(Y);s(et),k(Rt=>{f(Et,Rt),f(Ft,` / ${t(i),n(()=>t(i).weight)??""}`)},[()=>(t(w),t(i),n(()=>Number(t(w).summary[t(i).name]).toFixed(3)))]),g(X,et)};T(yt,X=>{t(w),t(i),ut(G),n(()=>t(w)?.summary&&t(i).weight>0&&G(t(i).name,t(w).summary))&&X(Dt)})}s(V),k(X=>{f(Pt,`${t(i),n(()=>t(i).name)??""}:`),f(W,X),f(rt,` / ${t(i),n(()=>t(i).weight)??""}`)},[()=>(t(d),t(i),n(()=>Number(t(d).summary[t(i).name]).toFixed(3)))]),g(I,V)};T(tt,I=>{t(i),ut(G),t(d),n(()=>t(i).weight>0&&G(t(i).name,t(d).summary))&&I(H)})}g(O,P)});var _t=l(it);{var kt=O=>{var i=de(),P=l(r(i)),tt=r(P);{var H=K=>{var L=ne();L.__click=()=>nt("bonus");var W=r(L);s(L),k(rt=>f(W,`+ ${rt??""}`),[()=>(t(d),n(()=>Number(t(d).summary.BonusAdded.replaceAll("+","")).toFixed(3)))]),g(K,L)};T(tt,K=>{t(d),n(()=>!isNaN(Number(t(d).summary.BonusAdded.replaceAll("+",""))))&&K(H)})}var I=l(tt,2);{var V=K=>{var L=ie(),W=r(L,!0);s(L),k(()=>f(W,(t(d),n(()=>t(d).summary.BonusAdded)))),g(K,L)};T(I,K=>{t(d),n(()=>isNaN(Number(t(d).summary.BonusAdded.replaceAll("+",""))))&&K(V)})}s(P);var z=l(P);{var Pt=K=>{var L=le(),W=dt(L),rt=r(W),pt=r(rt,!0);s(rt),s(W);var xt=l(W,2),yt=r(xt),Dt=r(yt,!0);s(yt),s(xt),k(()=>{f(pt,(t(d),n(()=>t(d)?.summary.BonusAdded))),f(Dt,(t(d),n(()=>t(d)?.summary.BonusAdded)))}),g(K,L)};T(z,K=>{t(d),n(()=>t(d)?.summary.BonusAdded)&&K(Pt)})}s(i),g(O,i)};T(_t,O=>{ut(G),t(d),n(()=>G("BonusAdded",t(d).summary))&&O(kt)})}var bt=l(_t),S=l(r(bt)),U=r(S),Tt=r(U,!0);s(U);var ea=l(U,2),sa=l(r(ea)),ga=r(sa,!0);s(sa),ct(),s(ea),s(S);var ra=l(S);{var ha=O=>{var i=ue(),P=r(i),tt=r(P,!0);s(P);var H=l(P,2),I=l(r(H)),V=r(I,!0);s(I),ct(),s(H),s(i),k(z=>{f(tt,z),f(V,(t(C),n(()=>t(C).summary.Grade)))},[()=>(t(C),n(()=>Number(t(C).summary.Points).toFixed(3)))]),g(O,i)};T(ra,O=>{t(C),n(()=>t(C)?.summary)&&O(ha)})}var Na=l(ra);{var Aa=O=>{var i=ce(),P=r(i),tt=r(P,!0);s(P);var H=l(P,2),I=l(r(H)),V=r(I,!0);s(I),ct(),s(H),s(i),k(z=>{f(tt,z),f(V,(t(w),n(()=>t(w).summary.Grade)))},[()=>(t(w),n(()=>Number(t(w).summary.Points).toFixed(3)))]),g(O,i)};T(Na,O=>{t(w),n(()=>t(w)?.summary)&&O(Aa)})}s(bt),s(Z),s(M),k(O=>{f(st,(t(d),n(()=>t(d).summary.FULLNAME))),f(Ot,(t(d),n(()=>t(d).summary.STUDENT_NO))),f(Kt,t(N)),f(Tt,O),f(ga,(t(d),n(()=>t(d).summary.Grade)))},[()=>(t(d),n(()=>Number(t(d).summary.Points).toFixed(3)))]),g(_,u)};T(pa,_=>{t(d),n(()=>t(d)?.summary)&&_(xa)})}s(At);var ta=l(At,2),aa=l(r(ta),2);aa.__click=async()=>{at.classSheetScore.destroy(),at.classrooms.destroy(),j.set(!0),await la()};var ya=l(aa,2);{var wa=_=>{var u=ve();u.__click=()=>{nt("sandbox")},g(_,u)};T(ya,_=>{m()&&_(wa)})}s(ta),k((_,u,b)=>{f(fa,`${_??""}
      ${u??""}`),f(_a,b)},[()=>(t(E),n(()=>t(E).toLocaleUpperCase())),()=>(t($),n(()=>t($).toUpperCase())),()=>(t(y),n(()=>t(y).toUpperCase()))]),Sa(Bt,()=>t(y),_=>D(y,_)),g(a,Wt),Fa(),A()}$a(["click"]);export{Oe as component};
