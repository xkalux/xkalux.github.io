import { local, isExpire } from "../appscript/classx.min.js"; import { updateTerminal } from "./_terminal.min.js"; import { LoadSetting } from "./_setting.min.js"; import { onWindowClose, onWindowOpen } from "./main.min.js"; var user = { element: document.querySelector("#desktop #user"), profile: void 0 }; function initUser() { if (!user?.element) return; const e = local("user"); if (e) try { user.profile = JSON.parse(e), user.profile.exp && !isExpire(user.profile.exp) ? (user.element.style.cursor = "default", user.element.querySelector(".picture").classList.remove("user-guest"), user.element.querySelector(".title").textContent = user.profile.name, user.element.querySelector(".sub-title").textContent = user.profile.email, user.element.querySelector(".picture").innerHTML = `<img class='img-profile' src='${user.profile.picture}'>`) : (sessionStorage.setItem("LOG", "token expire"), localStorage.removeItem("user")) } catch (e) { sessionStorage.setItem("LOG", e), localStorage.removeItem("user") } else user.profile = void 0, user.element.style.cursor = "pointer", user.element.querySelector(".picture").innerHTML = `<img alt="userimg" title='userimg' class='img-profile' src='./src/img/avatar/avatar-${Math.floor(7 * Math.random()) + 1}.svg'>`, user.element.querySelector(".title").textContent = "Guest", user.element.querySelector(".sub-title").textContent = "sign-in", user.element.addEventListener("click", handleLogin); LoadSetting(), updateTerminal() } function handleLogin(e) { login() } function login() { google.accounts.id.prompt((e => { if (e) { if (!user.element) return; user.element.removeEventListener("click", handleLogin), user.element.style.cursor = "default", initUser() } else { const e = document.createElement("x-window"); e.id = e.uid, e.setAttributes({ "window-title": "Error" }), e.doBeforeCreate = onWindowOpen, document.body.appendChild(e), e.contentElement.innerHTML = "Sorry, something went wrong", e.style.top = "20%", e.handleBeforeClose = () => { onWindowClose(e) } } })) } export { user, initUser, login }