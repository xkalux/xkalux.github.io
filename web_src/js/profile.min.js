let getProfileFn, xclassAPIobj, _subjectKey; function renderSubjectList(e, t, n) { if (!n) return; t && (xclassAPIobj = t), e && (getProfileFn = e); const a = getProfileFn(); if (!a) return handleUserIsNotLogin(n); const o = document.createElement("button"); o.innerHTML = "Refresh", n.querySelector("h2").appendChild(o); const i = document.createElement("div"); i.id = "profile-content", n.appendChild(i), o.addEventListener("click", (() => { onClickRefresh(a, i) })), loadSubjectFromLocalStorage(a, i) } function getSubjectKey(e) { return e ? _subjectKey || (_subjectKey = "classOF" + e.email.replace(".", "").replace("@rmuti.ac.th", ""), _subjectKey) : "guest" } function handleUserIsNotLogin(e) { const t = document.createElement("p"); t.innerHTML = "Service not available please sign-in with google account", e.appendChild(t) } function loadSubjectFromLocalStorage(e, t) { const n = getSubjectKey(e), a = localStorage.getItem(n); if (!a) { const s = document.createElement("p"); return s.innerHTML = "Data not found !\n        <ul>\n        <li> Click on 'Refresh' button.</li>\n        <li> Contact @x-kalux on Discord if data remains missing after refreshing.</li>\n        </ul>\n        ", void t.appendChild(s) } const o = JSON.parse(atob(a)); t.innerHTML = ""; for (let c = 0; c < o.length; c++) { const l = o[c], r = btoa(e + l.name), d = document.createElement("details"); d.classList.add("detail-of-subject-title"); const u = document.createElement("summary"), m = document.createElement("div"); if (u.textContent = l.name, m.innerHTML = `<x-loading title='Fetching ${l.name} data'></x-loading></div>`, d.appendChild(u), d.appendChild(m), sessionStorage.hasOwnProperty(r)) loadSubjectDataFromSession(r, m); else { function i() { u.removeEventListener("click", i), xclassAPIobj.getSubjecData(e, l, (e => { if ("ok" === e.status && null == e.datas.error) { const t = e.datas.datas, n = JSON.stringify(t); sessionStorage.setItem(r, n), loadSubjectDataFromSession(r, m) } else m.innerHTML = `<div> Something went wrong! ðŸ˜¢</div>\n                            <ul>\n                            <li> Status: ${e.status}</li>\n                            <li> Pleas contact @x-kalux on Discord</li>\n                            </ul>` })) } u.addEventListener("click", i) } t.appendChild(d) } } function loadSubjectDataFromSession(e, t) { const n = sessionStorage.getItem(e); if (n) { const e = document.createElement("div"); e.classList.add("subject-data-detail"); const a = JSON.parse(n); for (let t = 0; t < a.length; t++) { const n = a[t], o = document.createElement("details"); o.classList.add("detail-of-subject"); const i = document.createElement("summary"); i.textContent = n.sheetName, o.appendChild(i); for (let e = 0; e < n.data.length; e++) { if (n.header[e].toLowerCase().toString().includes("_hide")) continue; if (n.data[e].toString().length < 1) continue; const t = document.createElement("div"); t.classList.add("subject-record"); const a = document.createElement("span"); a.textContent = n.header[e]; const i = document.createElement("span"); i.innerHTML = n.data[e].toString().split("\\n").map((e => `<p>${e}</p>`)).join(""), t.appendChild(a), t.appendChild(i), o.appendChild(t) } e.appendChild(o) } t.innerHTML = "", t.appendChild(e) } } async function onClickRefresh(e, t) { t.innerHTML = "<x-loading title='Fetching data'></x-loading>", await xclassAPIobj.getSubjectList(e, (n => { if ("ok" === n.status) { sessionStorage.clear(); const a = JSON.stringify(n.datas); localStorage.setItem(_subjectKey, btoa(a)), loadSubjectFromLocalStorage(e, t) } else t.innerHTML = `<div> Something went wrong! ðŸ˜¢</div>\n            <ul>\n            <li> Status: ${n.status}</li>\n            <li> Pleas contact @x-kalux on Discord</li>\n            </ul>` })) } export { renderSubjectList }